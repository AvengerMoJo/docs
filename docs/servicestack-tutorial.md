---
title: Auth0 and ServiceStack
---

# Using Auth0 with ServiceStack

We provide a [Nuget package](http://nuget.org/packages/Auth0-ServiceStack-OAuthProvider/) to simplify integration of Auth0 with ServiceStack based applications. At the end of this tutorial you will have a working web site that calls a ServiceStack API with authenticated users. 

##Before you start

1. We assume you are familiar with [ServiceStack](http://www.servicestack.net/)
2. We also assume you have at least one [connection](@@uiURL@@/#/connections) either enabled or created. If you don't have one, this [tutorial](enable-simple-connection) shows how to enable Google OAuth2, one of the simplest connections possible.

###1. Create a simple MVC3 website and install ServiceStack through NuGet

For this example, we will use the standard template that ships with Visual Studio 2012. Select __"FILE -> New project -> MVC 3 Web Application -> Empty"__

Once the default template unfolds, use NuGet to install the **ServiceStack.Host.Mvc** nuget, running the command:

	Install-Package ServiceStack.Host.Mvc

![](img/install-servicestack-nuget.png)

Add the following line to your `Global.asax` file:

```
routes.IgnoreRoute("api/{*pathInfo}"); 
```

Add a `HomeController` to return the `default.htm` page. Under the __Controllers__ folder add:

```c#
public class HomeController : Controller
{
    public ActionResult Index()
    {
        return Redirect("default.htm");
    }
}
```

###2. Install Auth0 OAuthProvider

Run this command on the __Package Manager Console__:

	Install-Package Auth0-ServiceStack-OAuthProvider

This command will add two classes to your project under the __App_Start__ folder: `Auth0Provider` and `Auth0UserSession`. 

`Auth0Provider` extends ServiceStack's `OAuthProvider` and handles the authentication transaction for you. 

###3. Enable Authentication and plug in Auth0's Provider

Open the `AppHost.cs` file (also under the __App_Start__ folder) generated by the ServiceStack NuGet. Uncomment the following call under the `Configure` method:

```
ConfigureAuth(container);
```

And then uncomment and edit the `ConfigureAuth` method to look like this:

```c#
private void ConfigureAuth(Funq.Container container)
{
	var appSettings = new AppSettings();

    Plugins.Add(new AuthFeature(
                    () => new Auth0UserSession(),
                    new IAuthProvider[] {
                    new Auth0Provider(appSettings, appSettings.GetString("oauth.auth0.OAuthServerUrl"))
                }));

}
```

> In this sample we are not interested in user registration. So we are leaving that section out.

###4. Enter configuration settings

Open your `web.config` file and change the three Auth0's parameters under `<appSettings>`:

```
<add key="oauth.auth0.AppId" value="@@account.clientId@@" />
<add key="oauth.auth0.AppSecret" value="@@account.clientSecret@@" />
<add key="oauth.auth0.OAuthServerUrl" value="https://@@account.namespace@@" />
```

> These values can be obtained from the [Settings section](@@uiURL@@/#/Settings) on Auth0's Dashboard.

###5. Add backend code to test the app

Open the the `WebServiceExamples.cs` file. 

####1. Add the `Authenticate` attribute to the `Hello` DTO:

```c#
[Authenticate]
public class Hello
{
	public string Name { get; set; }
}
```

####2. Add an `IAuthSession` property to the `HelloResponse` DTO:

```c#
public class HelloResponse
{
    public IAuthSession UserInfo { get; set; }
	public string Result { get; set; }
	public ResponseStatus ResponseStatus { get; set; } //Where Exceptions get auto-serialized
}
```

####3. Modify the `HelloService` to return the currently logged in user's `UserInfo` object

```c#
public class HelloService : ServiceBase<Hello>
{
	protected override object Run(Hello request)
	{
        IAuthSession session = this.GetSession();
        var sb = new StringBuilder();
        sb.AppendLine("Id: " + session.Id);
        sb.AppendLine("DisplayName: " + session.DisplayName);

        var auth0Session = session as Auth0UserSession;
        var pic = auth0Session.ExtraData["picture"];

        return new HelloResponse { UserInfo = session };
	}
}
```
> Notice we are not doing anything useful with these properties. You can place a breakpoint here and explore the session object.

###6. Add UI code to Login and invoke the `HelloService`  

Open `default.htm` and:

####1. Add the following `script` tag (this is __Auth0 Login Widget__):

```
<script src="https://sdk.auth0.com/auth0.js#client=@@account.clientId@@&scope=openid"></script>
```

####2. Call `Hello` API

Add the following statement in the `jQuery.ready` body:

```js
// get user info from hello endpoint
$.getJSON('/api/hello', function (data) {
                $('#userInfo').text(JSON.stringify(data.userInfo, 1, 2));
          });
```

####3. Add Login buttons

Locate the `div` with `id=todoapp`. Add these two buttons under `content` div:

```html
<div>	
	<button class="btn" onclick="window.Auth0.signIn({onestep: true})">Log On (using Widget)</button> - or -
    <button class="btn" onclick="window.location='/api/auth/auth0/?connection=google-oauth2'">Log On (straight with Google)</button>
</div> 
```

> Notice that the second button uses a `connection` parameter in the query string. This should be equal to the connection name you defined in Auth0. In this example, we are using `google-oauth2`, which is typically enabled by default. You can replace this with anything you want.  
The first button, uses the __Auth0 Login Widget__, and will display all available connections for the user to pick up from.

####4. Add a section to display the `UserInfo`

Add this snippet at the end of the `content` div: 

```html
<div>User Info: 
     <pre><code id="userInfo">Not logged in</code></pre>
</div>
```

###7. Setup the callback URL in Auth0

Did you keep your [settings](@@uiURL@@/#/Settings) page open? Make sure the __callback address__ in Auth0 is configured with the app's callback URL. For ServiceStack this would be:

	http://{your-app}/api/auth0/

> In development, {your-app} would be something like `http://localhost:1234`

###8. Run the app

Run the app, you should see the `default.htm` page with the two buttons. Clicking on `Logon (Using Widget)` will display:

![](img/login-widget-servicestack.png)

After successful authentication, the `UserProfile` will be displayed on the page.

You are done. Congratulations! 
